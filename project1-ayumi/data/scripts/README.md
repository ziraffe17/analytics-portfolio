# サンプルデータ生成スクリプト

## 📊 概要

就労支援SaaS『あゆみ』のサンプルデータを生成するPythonスクリプトです。

実務に即したリアルなデータ分布と統計的に妥当な相関関係を持つデータを生成します。

---

## ✨ 特徴

- **実務に即したデータ分布**
  - 出席率の現実的な分布（優良30% / 良好40% / 要注意20% / 要支援10%）
  - 利用者の年齢・属性の実態に基づく設定

- **統計的に妥当な相関関係**
  - 睡眠不足 → ストレスレベル上昇 → 欠席率増加
  - 訓練時間長 → 自己評価向上
  - ストレス高 → 気分スコア低下

- **個人情報保護**
  - 全て架空のデータ（Fakerライブラリ使用）
  - 個人が特定できない設計

---

## 🚀 使い方

### 前提条件

- Python 3.8以上
- pip（Pythonパッケージ管理ツール）

### インストール

```bash
# 依存ライブラリをインストール
pip install -r requirements.txt
```

### 実行

```bash
# スクリプトを実行
python generate_sample_data.py
```

### 生成されるファイル

実行すると、以下の5つのCSVファイルが生成されます:

| ファイル名 | 行数 | 説明 |
|-----------|------|------|
| ayumi_users.csv | 25 | 利用者マスタ |
| ayumi_staffs.csv | 5 | スタッフマスタ |
| ayumi_attendance_records.csv | 1,650 | 出席記録（3ヶ月分） |
| ayumi_daily_reports_morning.csv | 1,449 | 朝日報 |
| ayumi_daily_reports_evening.csv | 1,449 | 夕日報 |

**合計データ量**: 4,578行

---

## 📐 データ設計のポイント

### 1. 出席率の分布

利用者を4つのセグメントに分類:

| セグメント | 出席率 | 割合 | 人数（25名中） |
|-----------|--------|------|---------------|
| 優良層 | 90%以上 | 30% | 7-8名 |
| 良好層 | 70-89% | 40% | 10名 |
| 要注意層 | 50-69% | 20% | 5名 |
| 要支援層 | 50%未満 | 10% | 2-3名 |

### 2. 相関関係の設計

#### 相関1: 睡眠時間 ↔ ストレスレベル

```python
# 睡眠不足だとストレスが高まる
if sleep_minutes < 360:  # 6時間未満
    stress_rating = 2 or 1  # 高ストレス
else:
    stress_rating = 3  # 低ストレス
```

#### 相関2: ストレスレベル ↔ 出席率

```python
# ストレスが高いと欠席しやすい
if stress_rating <= 1:
    absence_probability = 0.3  # 30%欠席
elif stress_rating == 2:
    absence_probability = 0.15  # 15%欠席
else:
    absence_probability = 0.05  # 5%欠席
```

#### 相関3: 訓練時間 ↔ 自己評価

```python
# 訓練時間が長いほど自己評価が高い傾向
if training_minutes >= 180:  # 3時間以上
    self_evaluation = 4 or 5
else:
    self_evaluation = 3
```

### 3. 時系列データの設計

- **期間**: 2024年10月1日 〜 2024年12月31日（3ヶ月）
- **営業日**: 月〜金（祝日除外）
- **出席パターン**: 午前・午後・終日の3区分
- **日報**: 出席日のみ記録

---

## 🔍 データ検証

生成されたデータは以下の観点で検証済み:

### ✅ データ品質

- NULL値なし（必須項目）
- 日付範囲の整合性（start_date ≤ report_date ≤ end_date）
- 外部キー制約の遵守（user_id, staff_id）
- 列挙型の妥当性（attendance_type, time_slot等）

### ✅ 統計的妥当性

```python
# 出席率の平均
attendance_rate_avg ≈ 75%  # (30%*95 + 40%*80 + 20%*60 + 10%*40)

# 睡眠時間の平均
sleep_hours_avg ≈ 6.5時間

# ストレスレベルの平均
stress_rating_avg ≈ 2.3  # (1-3の範囲で、やや高め)
```

### ✅ ビジネスロジック

- 利用者の年齢: 18-55歳（就労移行支援の実態）
- 利用期間: 最大2年（制度上の上限）
- 出席時間帯: 午前・午後・終日のいずれか
- 日報の記録タイミング: 出席日のみ

---

## 📊 データ活用例

### BigQueryへのアップロード

```bash
# BigQueryへのアップロード手順は以下を参照
# ../../docs/bigquery_upload_guide.md
```

### データ分析例

生成されたデータを使って以下の分析が可能:

1. **出席率トレンド分析**
   - 月次出席率の推移
   - 曜日別の出席パターン

2. **メンタルヘルス分析**
   - ストレスレベルの推移
   - 睡眠時間と出席率の相関

3. **訓練効果分析**
   - 訓練時間と自己評価の関係
   - プログラム別の効果測定

---

## 🛠️ カスタマイズ

### 利用者数を変更する場合

```python
# generate_sample_data.py の該当箇所を編集

# 利用者数を50名に変更
NUM_USERS = 50  # デフォルト: 25
```

### データ期間を変更する場合

```python
# 期間を6ヶ月に延長
START_DATE = datetime(2024, 7, 1)
END_DATE = datetime(2024, 12, 31)
```

---

## 📚 参考ドキュメント

- [データベース設計書](../../docs/database_design.md)
- [BigQueryアップロード手順](../../docs/bigquery_upload_guide.md)
- [プロジェクト全体README](../../README.md)

---

## 📝 更新履歴

| 日付 | 版 | 変更内容 |
|------|-----|---------|
| 2025-10-22 | 1.0 | 初版作成 |

---

最終更新: 2025年10月22日